" Tests for wwwsearch
" Initial set up  "{{{1

let s:SID_PREFIX = wwwsearch#_sid_prefix()
function Call(function_name, ...)
  return call(substitute(a:function_name, '^s:', s:SID_PREFIX, ''), a:000)
endfunction




function s:test_default_command_to_open_uri()  "{{{1
  Title "s:default_command_to_open_uri()"

  " FIXME: How do I write a portable test?
  " Assumption: This test is run on Mac OS X.
  Assert Call('s:default_command_to_open_uri') ==> 'open {uri}'
endfunction




function s:test_uri_escape()  "{{{1
  Title "s:uri_escape()"

  let safe_chars = ('ABCDEFGHIJKLMNOPQRSTUVWXYZ'
  \                 . 'abcdefghijklmnopqrstuvwxyz'
  \                 . '0123456789'
  \                 . '_.-'
  \                 . '/')

  " BUGS: NUL cannot be tested properly because of a restriction of Vim.
  for i in range(256)
    let c = nr2char(i)
    let expected = 0 <= stridx(safe_chars, c) ? c : printf('%%%02X', i)
    execute 'Assert' 'Call(''s:uri_escape'', '.string(c).')'
    \ '==>' string(expected)
  endfor
endfunction




function s:test_uri_to_search()  "{{{1
  Title "s:uri_to_search()"

  Assert Call('s:uri_to_search', 'keyword', 'default')
  \ ==> 'http://www.google.com/search?q=keyword'

  Assert Call('s:uri_to_search', 'keyword', 'google')
  \ ==> 'http://www.google.com/search?q=keyword'

  Assert Call('s:uri_to_search', '{keyword}', 'google')
  \ ==> 'http://www.google.com/search?q=%7Bkeyword%7D'
endfunction




function s:test_wwwsearch_add()  "{{{1
  Title "wwwsearch#add()"

  Assert wwwsearch#add('sasara', 'sasara {keyword} kawaii') ==> ''
  Assert Call('s:uri_to_search', 'is', 'sasara') ==> 'sasara is kawaii'

  Assert wwwsearch#add('sasara', 'sasara {keyword} super super mega kawaii')
  \ ==> 'sasara {keyword} kawaii'
  Assert Call('s:uri_to_search', 'is', 'sasara')
  \ ==> 'sasara is super super mega kawaii'
endfunction




function s:test_wwwsearch_cmd_Wwwsearch_complete()  "{{{1
  Title "wwwsearch#cmd_Wwwsearch_complete()"
endfunction




function s:test_wwwsearch_cmd_Wwwsearch()  "{{{1
  Title "wwwsearch#cmd_Wwwsearch()"
endfunction




function s:test_wwwsearch_search()  "{{{1
  Title "wwwsearch#search()"
endfunction




Test  "{{{1

" __END__
" vim: filetype=vim foldmethod=marker
